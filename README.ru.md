[![Статус сборки](https://ci.appveyor.com/api/projects/status/2q0mv1isiddp18ay?svg=true)](https://ci.appveyor.com/project/MultifactorLab/multifactor-adfs-adapter) [![Лицензия](https://img.shields.io/badge/license-view-orange)](LICENSE.ru.md)

## MultiFactor.ADFS.Adapter

_Also available in other languages: [English](README.md)_

MultiFactor.ADFS.Adapter позволяет защитить доступ к корпоративным Active Directory Federation Services (ADFS) приложениям с помощью гибридного 2FA решения <a href="https://multifactor.ru/" target="_blank">MultiFactor</a>.

Компонент разработан и поддерживается компанией Мультифактор, распространяется бесплатно вместе с исходным кодом.

* <a href="https://github.com/MultifactorLab/MultiFactor.ADFS.Adapter" target="_blank">Исходный код</a>
* <a href="https://github.com/MultifactorLab/MultiFactor.ADFS.Adapter/releases" target="_blank">Сборка</a>

Дополнительные инструкции по интеграции 2FA в ваши ADFS-приложения см. в документации https://multifactor.ru/docs/adfs-2fa/.

## Содержание

- [Схема работы](#схема-работы)
- [Доступные способы аутентификации](#доступные-способы-аутентификации)
- [Требования для установки компонента](#требования-для-установки-компонента)
- [Конфигурация](#конфигурация)
  - [Настройка Мультифактора](#настройка-мультифактора)
  - [Настройка ADFS](#настройка-adfs)
- [Дополнительная информация](#дополнительная-информация)
- [Лицензия](#лицензия)

## Схема работы

1. Пользователь открывает корпоративное приложение;
2. ADFS запрашивает первый фактор аутентификации: логин и пароль, проверяет корректность указанных данных и, если данные верны, переходит ко второму этапу аутентификации;
3. На втором этапе открывается окно проверки второго фактора Мультифактор, в котором пользователю предлагается подтвердить доступ;
4. Пользователь подтверждает второй фактор доступа и переходит к работе с приложением.

## Доступные способы аутентификации

* ``Мобильное приложение MultiFactor``
* ``Telegram``
* ``СМС``
* ``Биометрия``
* ``Аппаратные OTP токены``
* ``Программные OTP токены (например, Google Authenticator или Яндекс.Ключ)``

## Требования для установки

1. Компоненту необходим доступ к хосту api.multifactor.ru по TCP порту 443 (TLS) напрямую или через HTTP прокси;
2. На сервере должно быть установлено правильное время.


## Конфигурация 
### Настройка Мультифактора

1. Зайдите в [систему управления Мультифактором](/login), далее в раздел "Ресурсы" и создайте новый сайт с настройками по умолчанию;

### Настройка ADFS

1. Загрузите и распакуйте <a href="https://github.com/MultifactorLab/MultiFactor.ADFS.Adapter/releases" target="_blank">архив</a> на сервер с ADFS.
2. Отредактируйте файл конфигурации MultiFactor.ADFS.Adapter.dll.config: пропишите ключи доступа из личного кабинета Мультифактора;
3. Запустите PowerShell скрипт ```install.ps1``` с правами администратора;
4. Зайдите в консоль управления ADFS, в разделе **Authentication methods** -> **Multi-factor Authentication Methods** включите метод **MultiFactor**;
5. В разделе **Relying Party Trusts** отредактируйте **Access Policy** для приложений, где необходимо включить 2FA.

## Дополнительная информация

* Для работы в кластерной конфигурации компонент необходимо установить на все серверы кластера;
* Ошибки, связанные с работой компонента, можно посмотреть на сервере ADFS в журнале Windows: в разделе Applications с источником MultiFactor, а также в разделе ADFS.

## Лицензия 

Обратите внимание на [лицензию](LICENSE.ru.md). Она не дает вам право вносить изменения в исходный код Компонента и создавать производные продукты на его основе. Исходный код предоставляется в ознакомительных целях.

Смотрите также:
* <a href="https://multifactor.ru/docs/user-2fa-enrollment/" target="_blank">Регистрация пользователей в Мультифакторе</a>